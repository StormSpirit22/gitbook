# 分布式服务篇

## 服务化拆分

DAU（（Daily Active User）。目前的系统架构：

![img](/Users/tianyou/Documents/Github/ty/gitbook/.gitbook/assets/hc-service-1.png)

###  一体化架构的痛点

1. 数据库连接数可能成为系统的瓶颈。连接 MySQL 的客户端数量有限制， **最多可以设置为 16384** 。
2. 一体化架构增加了研发的成本，抑制了研发效率的提升。功能之间耦合严重，可能你只是更改了很小的逻辑，却导致其它功能不可用，从而在测试时需要对整体功能回归。
3.  一体化架构对于系统的运维也会有很大的影响。一次构建的过程，包括编译、单元测试、打包和上传到正式环境，花费的时间可能达到十几分钟，并且，任何小的修改，都需要构建整个项目，上线变更的过程非常不灵活。

### 微服务拆分

1. 按照业务做横向拆分的方式，解决数据库层面的扩展性问题。
2. 可以将与业务无关的公用服务抽取出来，下沉成单独的服务。

按照以上两种拆分方式将系统拆分之后，每一个服务的功能内聚，维护人员职责明确，增加了新的功能只需要测试自己的服务就可以了，而一旦服务出了问题，也可以通过服务熔断、降级的方式减少对于其他服务的影响。



## 系统架构改造

**微服务化之后，** 垂直电商系统的架构会将变成下面这样：

![img](/Users/tianyou/Documents/Github/ty/gitbook/.gitbook/assets/hc-service-2.png)

### 微服务拆分的原则

1.  做到单一服务内部功能的高内聚，和低耦合。
2. 服务拆分的粒度，先粗略拆分，再逐渐细化。
3. 拆分的过程，要尽量避免影响产品的日常功能迭代，也就是说，要一边做产品功能迭代，一边完成服务化拆分。
4.  服务接口的定义要具备可扩展性。



